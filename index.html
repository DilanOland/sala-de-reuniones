<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sala de Reuniones - Oland Seguros</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* ... (todo el CSS permanece igual) ... */
    </style>
</head>
<body>
    <!-- ... (todo el HTML permanece igual hasta el formulario) ... -->

    <div class="main-content">
        <div class="card">
            <div class="card-header">
                <div class="card-icon">
                    <i class="fas fa-calendar-plus"></i>
                </div>
                <h2>Nueva Reserva</h2>
            </div>
            <form id="reservation-form">
                <div class="form-group">
                    <label for="reservation-date">Fecha</label>
                    <input type="date" id="reservation-date" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="start-time">Hora de inicio</label>
                        <select id="start-time" required>
                            <option value="">Seleccione hora de inicio</option>
                            <!-- Las opciones se generarán dinámicamente -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="end-time">Hora de fin</label>
                        <select id="end-time" required>
                            <option value="">Seleccione hora de fin</option>
                            <!-- Las opciones se generarán dinámicamente -->
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="department">Departamento</label>
                    <select id="department" required>
                        <option value="">Seleccione un departamento</option>
                        <option value="SISTEMAS">SISTEMAS</option>
                        <option value="ASISTENCIA MEDICA">ASISTENCIA MEDICA</option>
                        <option value="RAMOS GENERALES">RAMOS GENERALES</option>
                        <option value="SINIESTROS">SINIESTROS</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="purpose">Propósito de la reunión</label>
                    <input type="text" id="purpose" placeholder="Ej: Revisión mensual de ventas" required>
                </div>
                <button type="submit" class="btn">
                    <i class="fas fa-check-circle"></i> Reservar Sala
                </button>
            </form>
        </div>

        <!-- ... (el resto del HTML permanece igual) ... -->
    </div>

    <script>
        // =============================================
        // CONFIGURACIÓN DE SUPABASE
        // =============================================
        const SUPABASE_URL = 'https://yadojzblxxilvjpoqdla.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlhZG9qemJseHhpbHZqcG9xZGxhIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MTY5NzMyMSwiZXhwIjoyMDc3MjczMzIxfQ.M4uSzFW96KVYxQFtboZOJcMxAgNbdRvfZXbOmz3MH7M';
        
        // Inicializar Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Variables globales
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let reservations = [];
        let currentUser = null;

        // Función para generar horarios de 30 en 30 minutos desde 8:30 hasta 17:30
        function generateTimeOptions() {
            const times = [];
            
            // Horarios desde 8:30 AM hasta 5:30 PM en intervalos de 30 minutos
            const timeSlots = [
                '08:30', '09:00', '09:30', '10:00', '10:30', '11:00', '11:30', 
                '12:00', '12:30', '13:00', '13:30', '14:00', '14:30', '15:00', 
                '15:30', '16:00', '16:30', '17:00', '17:30'
            ];
            
            return timeSlots;
        }

        // Función para poblar los select de horas
        function populateTimeSelects() {
            const timeOptions = generateTimeOptions();
            const startTimeSelect = document.getElementById('start-time');
            const endTimeSelect = document.getElementById('end-time');
            
            // Limpiar selects
            startTimeSelect.innerHTML = '<option value="">Seleccione hora de inicio</option>';
            endTimeSelect.innerHTML = '<option value="">Seleccione hora de fin</option>';
            
            // Poblar opciones de inicio (excluyendo la última opción)
            timeOptions.slice(0, -1).forEach(time => {
                const option = document.createElement('option');
                option.value = time;
                option.textContent = formatTime(time);
                startTimeSelect.appendChild(option);
            });
            
            // Poblar opciones de fin (excluyendo la primera opción)
            timeOptions.slice(1).forEach(time => {
                const option = document.createElement('option');
                option.value = time;
                option.textContent = formatTime(time);
                endTimeSelect.appendChild(option);
            });
        }

        // Función para actualizar las opciones de hora de fin basadas en la hora de inicio seleccionada
        function updateEndTimeOptions() {
            const startTime = document.getElementById('start-time').value;
            const endTimeSelect = document.getElementById('end-time');
            const timeOptions = generateTimeOptions();
            
            if (!startTime) {
                populateTimeSelects();
                return;
            }
            
            // Limpiar opciones de fin
            endTimeSelect.innerHTML = '<option value="">Seleccione hora de fin</option>';
            
            // Encontrar el índice de la hora de inicio seleccionada
            const startIndex = timeOptions.indexOf(startTime);
            
            // Poblar solo las horas posteriores a la hora de inicio seleccionada
            if (startIndex !== -1) {
                timeOptions.slice(startIndex + 1).forEach(time => {
                    const option = document.createElement('option');
                    option.value = time;
                    option.textContent = formatTime(time);
                    endTimeSelect.appendChild(option);
                });
            }
        }

        // ... (el resto del JavaScript permanece igual hasta el evento DOMContentLoaded) ...

        // Inicializar la aplicación
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar eventos de autenticación
            document.getElementById('login-btn').addEventListener('click', function() {
                const userName = document.getElementById('user-name').value;
                loginUser(userName);
            });

            document.getElementById('user-name').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const userName = document.getElementById('user-name').value;
                    loginUser(userName);
                }
            });

            document.getElementById('logout-btn').addEventListener('click', logoutUser);

            // Inicializar usuario
            initializeUser();
            
            // Establecer la fecha mínima en el formulario como hoy
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('reservation-date').min = today;
            document.getElementById('reservation-date').value = today;
            
            // Poblar los selects de horas
            populateTimeSelects();
            
            // Configurar evento para actualizar opciones de hora de fin
            document.getElementById('start-time').addEventListener('change', updateEndTimeOptions);
            
            // Configurar navegación del calendario
            document.getElementById('prev-month').addEventListener('click', function() {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                generateCalendar();
            });
            
            document.getElementById('next-month').addEventListener('click', function() {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                generateCalendar();
            });
            
            // Configurar botón "Hoy"
            document.getElementById('today-btn').addEventListener('click', function() {
                const now = new Date();
                currentMonth = now.getMonth();
                currentYear = now.getFullYear();
                generateCalendar();
            });
            
            // Configurar cierre del modal
            document.getElementById('close-modal').addEventListener('click', closeModal);
            
            // Cerrar modal al hacer clic fuera de él
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('day-details-modal');
                if (event.target === modal) {
                    closeModal();
                }
            });
        });
    </script>
</body>
</html>
